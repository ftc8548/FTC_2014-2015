#pragma config(Hubs,  S1, HTMotor,  HTMotor,  HTMotor,  none)
#pragma config(Sensor, S2,     gyroSensor,     sensorI2CHiTechnicGyro)
#pragma config(Sensor, S3,     irSensor,       sensorHiTechnicIRSeeker1200)
#pragma config(Motor,  mtr_S1_C1_1,     leftWheel,     tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C1_2,     liftMotor,     tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C2_1,     rightWheel,    tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C2_2,     pickupMotor,   tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C3_1,     liftMotor,     tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C3_2,     liftMotor,     tmotorTetrix, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "includes.h"

// raises the lift
void raiseLift(int seconds);
// lowers the lift
void lowerLift(int r_position);

const int timeGoal1 = 2 *1000;
const int timeGoal2 = 4 *1000;
const int timeGoal3 = 6 *1000;
const int timeGoal4 = 8 *1000;
typedef enum Position {
	upLow,
	upMiddle,
	upHigh,
	upCenter,
	down
};
Position position = down;

// raise lift to lowest goal task
task raise_LiftLow() {
	raiseLift(timeGoal1);
}

// raise lift to middle goal task
task raise_LiftMiddle() {
	raiseLift(timeGoal2);
}

// raise lift to high goal task
task raise_LiftHigh() {
	raiseLift(timeGoal3);
}

// raise lift to center goal task
task raise_LiftCenter() {
	raiseLift(timeGoal4);
}

// lowers the lift task
task lower_Lift() {
	lowerLift(position);
}
// main function
task main() {
	initializeGlobalVariables();
	while (true) {
		Joystick_UpdateData();

		// driving segment
/**////////////////////////////////////////////////////////////////////////////////////
/**/	// controls the left wheel													///
/**/	motor[leftWheel] = Joystick_GenericInput(JOYSTICK_L, AXIS_Y, CONTROLLER_1); ///
/**/	// controls the right wheel													///
/**/	motor[rightWheel] = Joystick_GenericInput(JOYSTICK_R, AXIS_Y, CONTROLLER_1);///
/**////////////////////////////////////////////////////////////////////////////////////

		// loop controlling the lift
/**////////////////////////////////////////////////////////////////////////////////////////////
/**/	// for the lowest rolling goal														///
/**/	if(Joystick_ButtonReleased(BUTTON_A, CONTROLLER_1) && position == down) {   		///
/**/		Task_Spawn(raise_LiftLow);														///
/**/		position = upLow;																///
/**/	}																					///
/**/	// for the middle rolling goal														///
/**/	else if(Joystick_ButtonReleased(BUTTON_B, CONTROLLER_1) && position == down) { 		///
/**/		Task_Spawn(raise_LiftMiddle);													///
/**/		position = upMiddle;															///
/**/	}																					///
/**/	// for the highest rolling goal														///
/**/	else if(Joystick_ButtonReleased(BUTTON_Y, CONTROLLER_1) && position == down) {		///
/**/		Task_Spawn(raise_LiftHigh);														///
/**/		position = upHigh;																///
/**/	}																					///
/**/	// for the center goal																///
/**/	else if(Joystick_ButtonReleased(BUTTON_X, CONTROLLER_1) && position == down) {		///
/**/		Task_Spawn(raise_LiftCenter);													///
/**/ 		position = upCenter;															///
/**/	}																					///
/**/	// lowers the lift all the way to the ground										///
/**/ 	else if(Joystick_ButtonReleased(BUTTON_START, CONTROLLER_1) && position != down) {	///
/**/		Task_Spawn(lower_Lift);															///
/**/		position = down;																///
/**/	}																					///
/**/	// raises the lift slightly															///
/**/	else if(Joystick_Button(BUTTON_RT, CONTROLLER_1)) {									///
/**/		while(Joystick_Button(BUTTON_RT, CONTROLLER_1)									///
/**/			motor[liftMotor] = 40;														///
/**/		motor[liftMotor] = 0;															///
/**/	}																					///
/**/ 	// lowers the lift slightly														///
/**/	else if(Joystick_Button(BUTTON_LT, CONTROLLER_1)) {									///
/**/		while(Joystick_Button(BUTTON_LT, CONTROLLER_1)) 								///
/**/			motor[liftMotor] = -40;														///
/**/		motor[liftMotor] = 0;															///
/**/	}																					///
///////////////////////////////////////////////////////////////////////////////////////////////

		// loop controlling the pickup
/**////////////////////////////////////////////////////////////////////////////////////
/**/	// for picking up 															///
/**/	while(Joystick_Button(BUTTON_RT, CONTROLLER_1)) {							///
/**/		motor[pickupMotor] = 87;												///
/**/	} 																			///
/**/	motor[pickupMotor] = 0;														///
/**/	// for releasing															///
/**/	while(Joystick_Button(BUTTON_LT, CONTROLLER_1)) {							///
/**/		motor[pickupMotor] = 87;												///
/**/	}																			///
/**/	motor[pickupMotor] = 0;														///
/**////////////////////////////////////////////////////////////////////////////////////
	}
	wait1Msec(1);
}

// raises the lift
void raiseLift(int seconds) {
	motor[liftMotor] = 87;
	wait1Msec(seconds);
	motor[liftMotor] = 0;
}

// lowers the lift
void lowerLift(int r_position) {
	motor[liftMotor] = -87;
	switch(r_position) {
		case upLow:
			wait1Msec(timeGoal1);
			break;
		case upMiddle:
			wait1Msec(timeGoal2);
			break;
		case upHigh:
			wait1Msec(timeGoal3);
			break;
		case upCenter:
			wait1Msec(timeGoal4);
			break;
		default:
			break;
	}
	motor[liftMotor] = 0;
}
